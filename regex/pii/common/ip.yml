namespace: comm
description: IP address patterns (IPv4 and IPv6)

patterns:
  - id: ipv4_01
    location: comm
    category: ip
    description: IPv4 address
    pattern: '\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b'
    mask: "*.*.*.*"
    examples:
      match:
        - "192.168.1.1"
        - "10.0.0.1"
        - "255.255.255.255"
      nomatch:
        - "256.1.1.1"
        - "192.168.1"
        - "192.168.1.1.1"
    policy:
      store_raw: false
      action_on_match: report
      severity: low

  - id: ipv6_01
    location: comm
    category: ip
    description: IPv6 address (full and compressed notation)
    pattern: '(?:(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,7}:|(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}|(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}|(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}|(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:(?:(?::[0-9a-fA-F]{1,4}){1,6})|:(?:(?::[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(?::[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(?:ffff(?::0{1,4}){0,1}:){0,1}(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])|(?:[0-9a-fA-F]{1,4}:){1,4}:(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9]))'
    flags: [IGNORECASE]
    mask: "****:****:****:****:****:****:****:****"
    examples:
      match:
        - "2001:0db8:85a3:0000:0000:8a2e:0370:7334"
        - "2001:0db8:85a3:1234:5678:8a2e:0370:7334"
        - "2001:db8:85a3::8a2e:370:7334"
        - "::1"
        - "fe80::"
        - "::"
      nomatch:
        - "192.168.1.1"
        - "gggg:gggg:gggg:gggg:gggg:gggg:gggg:gggg"
        - "02001:0db8:85a3:0000:0000:8a2e:0370:7334"
        - "2001:0db8:85a3::8a2e::7334"
    policy:
      store_raw: false
      action_on_match: report
      severity: low
    metadata:
      note: "Supports full form, compressed notation (::), link-local addresses, and IPv4-mapped IPv6 addresses"
